# 快递柜综合应用系统需求规格说明书 (修订版)

**版本号**：V1.0
**日期**：2026-01-16
**编制团队**：项目开发小组

---

## 1. 引言

### 1.1 编写目的

本文档旨在明确“快递柜综合应用系统”的功能需求、非功能需求及接口规范，重点界定软件端（小程序、Web后台、服务端）的业务逻辑，以及硬件部分的逻辑映射关系，为开发与测试提供统一标准。

### 1.2 项目背景

本项目为软硬件结合的课程设计项目。系统通过软件技术解决物流配送最后环节。
**特别说明**：本项目不涉及真实的硬件开发或复杂的硬件模拟器软件开发。硬件部分主要体现在**工业/系统设计图纸**（使用 MDesigner 等工具）以及**软件逻辑上的状态连通性**（即通过数据库状态字段映射硬件的开关/占用状态）。

### 1.3 适用范围

1. **服务端**：核心业务逻辑与数据中心。
2. **Web管理端**：管理员监控柜体逻辑状态的平台。
3. **快递员/用户端**：业务操作入口，触发逻辑状态变更。
4. **硬件设计**：仅包含 MDesigner 设计图纸与系统集成图。

---

## 2. 总体描述

### 2.1 用户角色

| 角色 | 描述 | 核心权限 |
| --- | --- | --- |
| **系统管理员** | 运营人员 | 查看柜门虚实状态、强制重置状态、管理用户。 |
| **快递员** | 配送人员 | 触发“入柜”逻辑，改变仓门状态为“占用”。 |
| **普通用户** | 收件人/寄件人 | 触发“取件/寄件”逻辑，改变仓门状态为“空闲/占用”。 |

> **【图表补充：此处插入《系统用例图》】**

### 2.2 运行环境

* **服务端**：Java Spring Boot + MySQL 8.0。
* **客户端**：微信小程序。
* **硬件逻辑层**：由关系型数据库直接承载（无需额外模拟器软件）。

---

## 3. 功能需求详细说明

### 3.1 硬件设计与逻辑集成需求

> **依据老师要求**：本模块不开发硬件模拟器代码，仅需完成设计图绘制与全链路逻辑打通。

#### 3.1.1 硬件系统设计（MDesigner）

需使用 **MDesigner** 软件绘制以下设计图，体现系统的组件构成与集成方案：

1. **组件构成图**：展示柜体、主控板、电磁锁、摄像头、4G模块、屏幕、传感器等组件的连接关系。
2. **系统集成图**：展示“云端服务器 <-> 4G模块 <-> 主控板 <-> 仓门锁”的通信链路逻辑。

> **【图表补充：此处插入 MDesigner 绘制的《组件构成图》】**
> **【图表补充：此处插入 MDesigner 绘制的《系统集成图》】**

#### 3.1.2 逻辑状态一致性

系统必须实现“前端操作”与“后台状态”的实时逻辑映射，替代物理硬件反馈。

* **开门逻辑**：
* **操作**：App 端点击“远程开门”或“扫码取件”。
* **反馈**：App 界面弹出文字提示（如“3号仓门已打开”）。
* **状态**：数据库 `compartments` 表对应记录的 `status` 字段保持为 `1` (正常)，但业务逻辑需记录该次操作日志。


* **物品放入逻辑**：
* **操作**：快递员在 App 确认“已存入”。
* **状态**：数据库 `compartments` 表对应记录的 `has_item` 字段由 `0` 变为 `1`。
* **验证**：此时刷新 Web 管理端页面，该仓门应显示为“占用/有物”状态。


* **取件闭环逻辑**：
* **操作**：用户输入取件码成功。
* **状态**：数据库 `has_item` 字段由 `1` 变回 `0`，订单状态变更为“已取件”。
* **验证**：Web 管理端该仓门恢复为“空闲”状态。



### 3.2 快递员端（微信小程序）

1. **投递入柜**：
* 扫码识别柜体 -> 请求后端查询可用空仓（`has_item=0`）。
* 选择仓门 -> 填写单号 -> 提交。
* **逻辑反馈**：界面提示“柜门已弹开，请放入物品”，点击“确认”后触发后端更新库存状态。


2. **揽件任务**：
* 查询用户寄件订单 -> 到柜前扫码 -> 界面提示“X号柜门已打开，请取走寄件”。



> **【界面补充：此处插入《快递员端 - 投递成功提示页截图》】**

### 3.3 普通用户端（微信小程序）

1. **取件**：
* 输入取件码 -> 后端校验通过。
* **逻辑反馈**：界面提示“X号柜门已打开，请取件”，同时后端释放该仓门占用状态。


2. **寄件**：
* 在线填单 -> 预约空柜 -> 到柜扫码/输码。
* **逻辑反馈**：界面提示“柜门已开，放入后请关门”，前端确认后后端标记该仓为“占用”。



> **【界面补充：此处插入《用户端 - 取件成功提示页截图》】**

### 3.4 Web 管理平台

1. **状态监控**：
* **柜门视图**：以网格形式（可视化）展示当前柜子的所有仓门。
* **实时同步**：当 App 端进行存/取操作后，刷新此页面，必须能看到对应格子的颜色或状态发生变化（例如：空闲显示绿色，有物显示红色）。


2. **远程控制**：
* 点击某个仓门的“强制开门”按钮，触发后端接口，App 端（如果在线）或操作日志中应有相应记录。



> **【界面补充：此处插入《Web端 - 柜体状态监控大屏截图》】**

---

## 4. 数据需求

基于现有数据库设计，系统需维护以下核心数据以支撑逻辑流转：

> **【图表补充：此处插入《数据库 E-R 关系图》】**

* **Cabinets (柜体表)**：定义柜子的基础信息（编号、总仓数）。
* **Compartments (仓门表)**：
* `id`: 主键。
* `status`: **逻辑开关状态**（1=正常/可用，0=故障/禁用）。
* `has_item`: **逻辑占用状态**（1=有包裹，0=空闲）。此字段是实现“逻辑一致性”的核心。


* **ExpressOrders (订单表)**：关联仓门 ID，记录流转过程。

---

## 5. 接口与交互设计

### 5.1 通信协议

* **架构**：RESTful API。
* **鉴权**：Bearer Token (JWT)。

### 5.2 关键业务流程

#### 场景：快递员存件

1. **查询**：App 请求 `GET /api/cabinets/{id}/compartments/available`。
* *后端逻辑*：`SELECT * FROM compartments WHERE cabinet_id=1 AND status=1 AND has_item=0`。


2. **锁定**：App 提交订单 `POST /api/orders`。
* *后端逻辑*：`UPDATE compartments SET has_item=1 WHERE id=X; INSERT INTO express_orders ...`。


3. **反馈**：API 返回 `200 OK`。
4. **展示**：App 弹窗“3号门已开，请放入”。
5. **验证**：管理员刷新 Web 页面，看到 3号门变为“占用”。

> **【图表补充：此处插入《存件业务时序图》】**

---

## 6. 非功能性需求

1. **数据一致性**：App 端操作完成后，Web 管理端查询到的数据必须在 1 秒内同步（即数据库事务提交及时）。
2. **界面反馈**：由于没有真实物理开门声，App 端必须有醒目的大字提示“门已开”或“操作成功”，以确保用户感知逻辑完成。

---

## 7. 附录：开发计划与交付物

* **软件交付物**：
1. 前后端源代码。
2. 可运行的系统（能演示 App 操作 -> Web 状态改变的闭环）。


* **文档/设计交付物**：
1. **MDesigner 设计图**（组件构成图、系统集成图）。
2. 需求规格说明书（本文档）。
3. 系统设计说明书（含 UML 图）。
4. 测试报告（重点测试逻辑状态的流转准确性）。



> **【内容扩充：此处插入《MDesigner 设计图缩略预览》】**