<navigation-bar title="åœ°å€ç®¡ç†" back="{{true}}" color="black" background="#f7f7f7"></navigation-bar>

<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- åœ°å€åˆ—è¡¨ -->
    <view class="address-list" wx:if="{{addresses.length > 0}}">
      <view 
        class="address-item" 
        wx:for="{{addresses}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="editAddress"
      >
        <view class="address-info">
          <view class="address-header">
            <text class="name">{{item.name}}</text>
            <text class="phone">{{item.phone}}</text>
            <text class="default-tag" wx:if="{{item.isDefault}}">é»˜è®¤</text>
          </view>
          <view class="address-detail">{{item.province || ''}}{{item.city || ''}}{{item.district || ''}}{{item.detail}}</view>
        </view>
        <view class="address-actions">
          <text class="action-btn edit" catchtap="editAddress" data-id="{{item.id}}">ç¼–è¾‘</text>
          <text class="action-btn delete" catchtap="deleteAddress" data-id="{{item.id}}">åˆ é™¤</text>
          <text class="action-btn set-default" catchtap="setDefaultAddress" data-id="{{item.id}}" wx:if="{{!item.isDefault}}">è®¾ä¸ºé»˜è®¤</text>
        </view>
      </view>
    </view>

    <!-- ç©ºåœ°å€æç¤º -->
    <view class="empty-address" wx:if="{{addresses.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ“</text>
      <text class="empty-text">æš‚æ— æ”¶è´§åœ°å€</text>
    </view>

    <!-- æ·»åŠ åœ°å€æŒ‰é’® -->
    <button class="add-address-btn" bindtap="openAddModal">+ æ·»åŠ æ–°åœ°å€</button>
  </view>
</scroll-view>

<!-- åœ°å€ç¼–è¾‘å¼¹çª— -->
<view class="modal" wx:if="{{showModal}}">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">{{editingAddress ? 'ç¼–è¾‘åœ°å€' : 'æ·»åŠ åœ°å€'}}</text>
      <text class="modal-close" bindtap="closeModal">Ã—</text>
    </view>
    <view class="modal-body">
      <view class="form-item">
        <text class="form-label">æ”¶è´§äºº</text>
        <input 
          class="form-input" 
          placeholder="è¯·è¾“å…¥æ”¶è´§äººå§“å" 
          value="{{formData.name}}" 
          bindinput="onInputChange"
          data-field="name"
        />
      </view>
      <view class="form-item">
        <text class="form-label">æ‰‹æœºå·</text>
        <input 
          class="form-input" 
          placeholder="è¯·è¾“å…¥æ‰‹æœºå·" 
          value="{{formData.phone}}" 
          bindinput="onInputChange"
          data-field="phone"
          type="number"
          maxlength="11"
        />
      </view>
      <view class="form-item">
        <text class="form-label">è¯¦ç»†åœ°å€</text>
        <textarea 
          class="form-textarea" 
          placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€" 
          value="{{formData.detail}}" 
          bindinput="onInputChange"
          data-field="detail"
          auto-height
          maxlength="200"
        ></textarea>
      </view>
      <view class="form-item checkbox-item">
        <switch 
          checked="{{formData.isDefault}}" 
          bindchange="onSwitchChange"
          data-field="isDefault"
          color="#07c160"
        ></switch>
        <text class="checkbox-label">è®¾ä¸ºé»˜è®¤åœ°å€</text>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="closeModal">å–æ¶ˆ</button>
      <button class="btn-save" bindtap="saveAddress" loading="{{saving}}">{{saving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜'}}</button>
    </view>
  </view>
</view>
