# 工作日志

## 1月12日-14日 听课培训

## 1月15日 环境配置

### 上午
- 搭建开发环境：安装微信开发者工具、Node.js等必要工具
- 配置项目目录结构：创建user_xcx目录和相关文件结构
- 初始化小程序项目：配置app.json、app.js等基础文件

### 下午
- 配置后端服务连接：设置API请求地址和网络请求封装
- 测试数据库连接：验证MySQL服务是否正常运行
- 初始化项目依赖：检查并配置必要的开发依赖

启动后端：
cd "e:\professional_design\project3\Professional-comprehensive-design\server\backend" ; .\mvnw.cmd spring-boot:run

## 1月16日 项目开发

### 上午
- **项目分工**：确定负责用户端小程序开发，主要包括用户认证、快递柜管理、存件取件等功能模块
- **架构设计**：设计小程序页面结构和导航流程
- **基础框架搭建**：
  - 创建API请求封装工具类（utils/api.js、utils/service.js）
  - 配置全局状态管理（app.js）
  - 实现页面路由配置（app.json）

### 下午
- **核心功能开发**：
  - 用户认证模块：登录页面（login）、注册页面（register）
  - 快递柜管理：快递柜列表页面（cabinets）、快递柜详情页面（cabinet-detail）
  - 存件功能：存件页面（store）
  - 取件功能：取件页面（pick-up）
  - 订单管理：订单列表页面（orders）
  - 个人中心：个人中心页面（profile）
  - 启动页面：优化启动页（index）

- **问题解决**：
  - 修复Skyline渲染器兼容性问题
  - 解决网络请求域名校验问题
  - 修复数据结构不匹配问题
  - 解决页面跳转方式错误问题

- **功能验证**：
  - 测试用户登录功能（使用测试账号admin/123456）
  - 验证快递柜列表数据加载
  - 测试API接口调用正常
  - 确认小程序可以正常运行

### 开发成果
- 完成了用户端小程序的完整开发
- 实现了所有核心功能模块
- 修复了开发过程中的各种技术问题
- 小程序可以正常运行并通过登录测试

### 技术栈使用
- 微信小程序原生开发
- JavaScript ES6+
- 模块化架构设计
- RESTful API调用
- 响应式UI设计

## 后续计划
- 完善小程序的UI设计和用户体验
- 测试所有功能模块的完整性
- 优化网络请求和页面性能
- 准备项目交付和文档整理

## 1月17日 项目开发继续

### 功能问题修复
- **快递柜列表显示问题**：
  - 问题：登录后无法查看快递柜列表
  - 原因：字段名不匹配（前端使用 name/code/address，后端返回 cabinetCode/location）
  - 修复：添加字段映射，适配前端显示

- **格口状态判断问题**：
  - 问题：所有格口显示"占用"状态
  - 原因：状态判断逻辑错误（将 status === 1 错误判定为"占用"）
  - 修复：改为使用 hasItem === 1 判定占用状态

- **可用格口数量显示问题**：
  - 问题：所有快递柜显示"可用格口：8"，与实际状态不符
  - 原因：直接使用 totalCompartments 而不是实际可用数量
  - 修复：从后端API获取实际可用格口数量

- **存件功能问题**：
  - 问题：存件失败，数据库约束异常
  - 原因：字段名不匹配（使用 expressNumber 而不是 orderNo），缺少必填字段（orderType、status）
  - 修复：修正字段名，添加必填字段

- **后端服务问题**：
  - 问题：无法连接后端服务
  - 原因：后端服务未启动
  - 修复：重启后端服务

### 功能验证
- ✅ 用户登录功能正常
- ✅ 快递柜列表显示正常
- ✅ 格口状态显示正确
- ✅ 存件功能正常（生成取件码）
- ✅ 取件功能正常（输入取件码开仓）
- ✅ 订单管理功能正常

### 技术改进
- 优化API请求封装，添加错误处理
- 完善字段映射，适配前后端数据结构
- 改进状态判断逻辑，提升用户体验
- 添加详细的功能测试指南

## 1月19日 项目开发继续

### 功能问题修复
- **订单显示问题**：修复订单页面字段映射，确保快递单号、格口等信息完整显示
- **订单创建问题**：添加receiverUserId字段设置，确保订单与用户关联
- **数据传递问题**：确保订单创建时传递完整的快递公司信息

### 技术改进
- 在ExpressOrder实体中添加compartmentNo字段，存储用户可见的格口号
- 修改ExpressOrderService订单创建逻辑，从Compartment实体获取格口号
- 优化前端字段显示逻辑，使用正确的字段名
- 提升字段显示的默认值处理，改善用户体验

### 剩余问题
- **格口号对应错误**：前端显示的格口号与实际存储的格口号不一致，需进一步测试验证

